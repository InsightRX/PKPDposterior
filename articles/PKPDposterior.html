<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PKPDposterior">
<title>Getting started • PKPDposterior</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="PKPDposterior">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PKPDposterior</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/PKPDposterior.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Documentation</h6>
    <a class="dropdown-item" href="../articles/model-syntax.html">Model syntax</a>
    <a class="dropdown-item" href="../articles/sampler-settings.html">Sampler settings</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/example-vanco.html">Vancomycin</a>
    <a class="dropdown-item" href="../articles/example-pkpd-neutropenia.html">Neutropenia (PKPD)</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://ds.insight-rx.com/" aria-label="Home">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started</h1>
            
      
      
      <div class="d-none name"><code>PKPDposterior.Rmd</code></div>
    </div>

    
    
<p>We will start with defining a simple population PK model, for a fictitious drug. We will define a one-compartment model, defined using standard PK parameters, inter-individual variability (IIV) and residual variability. We will then provide some TDM data, and sample from the posterior to learn about the patient’s individual PK parameters.</p>
<p>First, we will load the necessary libraries</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightrx.github.io/PKPDposterior/">PKPDposterior</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/InsightRX/PKPDsim" class="external-link">PKPDsim</a></span><span class="op">)</span></span></code></pre></div>
<p>and define the values of the population PK parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  CL <span class="op">=</span> <span class="fl">5</span>, </span>
<span>  V1 <span class="op">=</span> <span class="fl">50</span>, </span>
<span>  Q <span class="op">=</span> <span class="fl">5</span>, </span>
<span>  V2 <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>and the IIV (as standard deviation) and RUV:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iiv</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  CL <span class="op">=</span> <span class="fl">0.3</span>, </span>
<span>  Q <span class="op">=</span> <span class="fl">0.49</span>, </span>
<span>  V1 <span class="op">=</span> <span class="fl">0.15</span>, </span>
<span>  V2 <span class="op">=</span> <span class="fl">1.3</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ruv</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  add <span class="op">=</span> <span class="fl">1.6</span>, </span>
<span>  prop <span class="op">=</span> <span class="fl">0.15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we can use <code><a href="../reference/new_stan_model.html">new_stan_model()</a></code> to define the model equations. Since this is a simple linear PK model, we do not have to define the ODE system ourselves, but can instead use the analytic solution that is built into Torsten. The only thing we need to define is how the parameters in Torsten related to any covariates that we want to use in the model. In this example, we’ll implement an allometric model for the PK parameters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stan_model.html">new_stan_model</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="va">pars</span>,</span>
<span>  parameter_definitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"CL"</span> <span class="op">=</span> <span class="st">"CL * (WT[j]/70)^0.75"</span>,</span>
<span>    <span class="st">"Q"</span>  <span class="op">=</span> <span class="st">"Q  * (WT[j]/70)^0.75"</span>,</span>
<span>    <span class="st">"V1"</span> <span class="op">=</span> <span class="st">"V1 * (WT[j]/70)"</span>,</span>
<span>    <span class="st">"V2"</span> <span class="op">=</span> <span class="st">"V2 * (WT[j]/70)"</span>,</span>
<span>    <span class="st">"KA"</span> <span class="op">=</span> <span class="st">"0"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  covariate_definitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"WT"</span> <span class="op">=</span> <span class="st">"real"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  solver <span class="op">=</span> <span class="st">"pmx_solve_twocpt"</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"(V1 * mean(WT))"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The other elements that were specified above were:</p>
<ul>
<li>the covariate definitions: we only need to specify what the data type of the respective covariates is. Here, we only have a continuous covariate, so we specify it as <code>real</code>.</li>
<li>the solver: the two-compartment analytic equation in Torsten is referenced as <code>pmx_solve_twocpt</code>. Please refer to the Torsten documentation for more information about the available solvers.</li>
<li>the scale: how the observed data relate to the modeled quantity (amounts in blood).</li>
</ul>
<p>We can then write this model to file, and compile it using Stan:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_stan_model.html">write_stan_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_model.html">load_model</a></span><span class="op">(</span><span class="va">model_file</span><span class="op">)</span></span></code></pre></div>
<p>Next, we should define the dosing regimen for the drug, as well as patient covariates, which is done using PKPDsim functionality:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regimen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/new_regimen.html" class="external-link">new_regimen</a></span><span class="op">(</span></span>
<span>  amt <span class="op">=</span> <span class="fl">1500</span>, </span>
<span>  n <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">48</span><span class="op">)</span>, </span>
<span>  type <span class="op">=</span> <span class="st">'infusion'</span>,</span>
<span>  cmt <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  t_inf <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>WT <span class="op">=</span> <span class="fu"><a href="https://insightrx.github.io/PKPDsim/reference/new_covariate.html" class="external-link">new_covariate</a></span><span class="op">(</span><span class="fl">70</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can define the TDM data that we want to use to inform the posterior:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">11.5</span><span class="op">)</span>, </span>
<span>  dv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"pk"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These data inputs should then be combined into a Stan dataset:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_stan_data.html">new_stan_data</a></span><span class="op">(</span></span>
<span>  regimen <span class="op">=</span> <span class="va">regimen</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">covariates</span>, </span>
<span>  data <span class="op">=</span> <span class="va">tdm_data</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">pars</span>,</span>
<span>  iiv <span class="op">=</span> <span class="va">iiv</span>,</span>
<span>  ruv <span class="op">=</span> <span class="va">ruv</span>,</span>
<span>  dose_cmt <span class="op">=</span> <span class="fl">2</span> <span class="co"># into the central compartment</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we have both the model and the data ready to sample from the posterior:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mcmc_posterior.html">get_mcmc_posterior</a></span><span class="op">(</span></span>
<span>  mod <span class="op">=</span> <span class="va">mod</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MCMC with 1 chain...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration:  50 / 1000 [  5%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 150 / 1000 [ 15%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 250 / 1000 [ 25%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 350 / 1000 [ 35%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 450 / 1000 [ 45%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) </span></span>
<span><span class="co">## Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 550 / 1000 [ 55%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 650 / 1000 [ 65%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 750 / 1000 [ 75%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 850 / 1000 [ 85%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 950 / 1000 [ 95%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) </span></span>
<span><span class="co">## Chain 1 finished in 0.5 seconds.</span></span></code></pre>
<p>Summary info about the posterior can be shown by just evaluating the object:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span></span></code></pre></div>
<pre><code><span><span class="co">## Parameters:</span></span>
<span><span class="co">##    posterior_mode   mean median      sd     q5     q95  rhat</span></span>
<span><span class="co">## CL          1.799  2.078  1.975   0.742  1.011   3.403 1.017</span></span>
<span><span class="co">## V1         22.535 20.997 20.907   6.065 11.872  30.279 1.006</span></span>
<span><span class="co">## Q           2.304  4.413  3.509   3.130  1.276  10.522 1.014</span></span>
<span><span class="co">## V2          1.036 43.435  1.640 214.182  0.298 174.659 1.017</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Observed data, posterior:</span></span>
<span><span class="co">##   type time dv      mean         loc pct      pct5     pct95</span></span>
<span><span class="co">## 1   pk  2.5 40 0.9100449 -----|----o   1 0.5472757 1.5048305</span></span>
<span><span class="co">## 2   pk 11.5 14 0.3743409 -----|----o   1 0.1327699 0.7291447</span></span></code></pre>
<p>Parameter distributions for the posterior and prior can be plotted using the <code><a href="../reference/plot_params.html">plot_params()</a></code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_params.html">plot_params</a></span><span class="op">(</span><span class="va">post</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre>
<p><img src="PKPDposterior_files/figure-html/params-distr-1.png" width="700"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ron Keizer, Jasmine Hughes, Dominic Tong, Kara Woo, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
